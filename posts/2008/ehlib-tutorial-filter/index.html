<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><link rel=prev href=https://www.delphier.com/posts/2008/newyear2008/><link rel=next href=https://www.delphier.com/posts/2008/prisonbreak-lost-return/><link rel=canonical href=https://www.delphier.com/posts/2008/ehlib-tutorial-filter/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>EhLib 使用教程：Ehlib 过滤功能的实现 | Delphier.com</title><meta name=title content="EhLib 使用教程：Ehlib 过滤功能的实现 | Delphier.com"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><meta name=twitter:card content=summary><meta name=twitter:title content="EhLib 使用教程：Ehlib 过滤功能的实现"><meta name=twitter:description content="EhLib 是一套 Delphi 第三方组件库，虽然其只有十多个组件，没有 DevExpress 系列那般功能强大，但却简单易用，提供了一些实际开发中非常实用的功能。其中最为代表性的是 DBGirdEh"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"EhLib 使用教程：Ehlib 过滤功能的实现","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.delphier.com\/posts\/2008\/ehlib-tutorial-filter\/"},"genre":"posts","keywords":"Delphi, EhLib","wordcount":1667,"url":"https:\/\/www.delphier.com\/posts\/2008\/ehlib-tutorial-filter\/","datePublished":"2008-01-03T00:00:00\x2b00:00","dateModified":"2008-01-03T00:00:00\x2b00:00","description":""}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://www.delphier.com/>Delphier.com</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=https://github.com/Delphier/DxAutoInstaller>DxAutoInstaller</a>
<a class=menu-item href=/categories/>Categories</a>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;</div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;<a href=https://www.delphier.com/>Delphier.com</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=https://github.com/Delphier/DxAutoInstaller>DxAutoInstaller</a>
<a class=menu-item href=/categories/>Categories</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>EhLib 使用教程：Ehlib 过滤功能的实现</h1><div class=post-meta>Written by <a href=https://www.delphier.com/ rel=author>Delphier</a> with ♥
<span class=post-time>on <time datetime=2008-01-03>3 January 2008</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://www.delphier.com/categories/delphi/>Delphi</a></span>
<i class="iconfont icon-timer"></i>4 min</div></header><div class=post-content><p><a href=http://www.ehlib.com/>EhLib</a> 是一套 Delphi 第三方组件库，虽然其只有十多个组件，没有 DevExpress 系列那般功能强大，但却简单易用，提供了一些实际开发中非常实用的功能。其中最为代表性的是 DBGirdEh 表格组件。</p><p>DBGridEh 可以为你提供一个更加美观和功能丰富的 DBGird，比如平面化显示、奇偶行不同颜色（斑马线）、快速查找、合计行、Grid 打印等。在 Ehlib 的后期版本中，还提供了一个非常强大的过滤功能，他会在 DBGrid 的表头下方显示一个过滤行，用户在此行的相应列中输入查询条件，DBGridEh 可以自动为您筛选出所需要的数据。下图所示即为启用过滤功能后的 DBGridEh：</p><p><figure><img src=/images/ring.svg data-sizes=auto data-src=/images/2008/ehlib-filter.png alt class=lazyload><figcaption class=image-caption></figcaption></figure></p><p>鉴于之前 <a href=/posts/2007/ehlib-4216-cn-release/>EhLib 汉化版</a>发布时，很多人问到 EhLib 过滤功能的实现方式，并要求提供一个示例，所以下面我会简单介绍一下 EhLib 过滤功能的实现，相关代码及可执行文件会发布到 <a href=http://www.2ccc.com/>Delphi 盒子</a>，请到那里去搜索并下载。</p><h2 id=1-过滤实现的前提条件-uses-ehlibado-ehlibbde-等>1、过滤实现的前提条件：uses EhlibADO, EhlibBDE 等 ….</h2><p>要实现 DBGridEh 的自动过滤，必须先添加 Ehlib 的几个相关 unit 到你的 project 中，如果你使用的是 ADO 连接数据库，请在工程任一 unit 的 uses 列表中添加 EhlibADO，如果使用的是 BDE，请添加 EhlibBDE，其他可能添加的还有：EhlibCDS、EhlibDBX、EhlibIBX、EhlibMTE；</p><h2 id=2-启用过滤-显示过滤行-dbgrideh-stfilter-visible-true>2、启用过滤，显示过滤行：DBGridEh.STFilter.Visible := True</h2><p>DBGridEh 默认不显示过滤行，设置 STFilter.Visible 为 True 过滤行就显示出来了。</p><h2 id=3-选择-客户端还是服务器端过滤-dbgrideh-stfilter-local-true-false>3、选择：客户端还是服务器端过滤？DBGridEh.STFilter.Local = True|False</h2><p>这一步很主要。客户端过滤也就是 Query 自身的过滤功能，在内存中过滤，不会到服务器端去查询，优点是实现简单，过滤速度快，缺点就是只能获得本地更新的数据，其他用户新增和修改的数据无法实时反映出来。</p><p>DBGridEh 服务器端过滤的实现方式是“拼凑”SQL 语句。在过滤之前，DBGridEh 绑定的 Query 的 SQL 语句必须含有 DBGridEh 指定的一个过滤标记，该过滤标记默认为 <code>/*Filter*/</code>，其必须在 SQL 任一行的行首，当用户输入过滤值时，EhLib 生成过滤条件，并且用此条件替换过滤标记之后的内容，然后将新的SQL 语句发送到数据库端去执行，获得的即为过滤后的数据。</p><p>具体应该使用哪种过滤方式，需根据实际要求选用。</p><h2 id=4-客户端过滤-本地过滤-的实现-dbgrideh-stfilter-local-true>4、客户端过滤（本地过滤）的实现：DBGridEh.STFilter.Local := True</h2><p>客户端过滤实现比较简单，而且容易理解，设置 Local 为 True，过滤功能就 OK 了。</p><h2 id=5-服务器端过滤的实现-dbgrideh-stfilter-local-false>5、服务器端过滤的实现：DBGridEh.STFilter.Local := False</h2><p>服务器端过滤需设置 Local 为 False，然后剩下的就是 SQL 语句，SQL 一般为以下样式：</p><p><code>AdoQuery.SQL.Text := 'SELECT * FROM Students WHERE ' + #13 +'/*Filter*/1=1';</code></p><p>以上代码生成的 SQL 在 SQL Server 等支持 /* 注释的数据库中会非常正确的执行，但在 Access 中就会出错，解决方案也很简单，更改 DBGridEh 的过滤标记即可：</p><p><code>DBUtilsEh.SQLFilterMarker := '(1&gt;0)AND';</code></p><p>那么 Query 的 SQL 应该为以下：</p><p><code>AdoQuery.SQL.Text := 'SELECT * FROM Students WHERE ' + #13 + '(1&gt;0)AND 1=1';</code></p><p>服务器端过滤也 OK 了！</p><p>注：如果你使用的是 Delphi 2007，你可能会发现当你完全无误按以上设置后，服务器端过滤功能还是无效，这是由于 Ehlib DBUtilsEh 单元的一处 Bug 造成的，此 Bug 产生的原因请查看该文：<a href=/posts/2007/ehlib-delphi2007-filter/>EhLib 4.1 在 Delphi 2007 下无法过滤和排序的问题</a>。（本示例代码中包含了修正过的 DBUtilsEh，请到 Delphi 盒子下载）</p><h2 id=6-过滤行下拉列表的实现-column-stfilter-listsource-listfield-keyfield>6、过滤行下拉列表的实现：Column.STFilter.ListSource、ListField、KeyField</h2><p>DBGridEh 的过滤行可以将某列已存在的值以 ComboBox 的形式显示出来，要实现此功能，需设置 DBGridEh 列的 STFilter 属性。将 ListSource 设为要下拉显示的数据源，ListField 为下拉列表显示的字段，KeyField 为构建查询表达式使用的字段。</p><p>设置以上属性后，你可能发现虽然下拉列表显示出来了，但选择下拉列表值后，DBGridEh 却没有自动过滤，在单元的 initialization 节添加以下代码即会自动过滤了：</p><p><code>DBGridEhCenter.FilterEditCloseUpApplyFilter := True;</code></p><p>这个方法感觉很奇怪，而且在使用中好像也有问题，当输入 &gt; &lt;这样的表达式时，查询时会出错。在官方的 Demo 中，是通过内存表的方式实现的，而且不用设置任何属性（上面的 ListSource 等都不用设置），即可自动在过滤行每列处显示下拉列表，详细用法请参照 Ehlib 安装目录下的 Demo。</p><p>（注：本示例代码不包含过滤行下拉列表的实现演示）</p><p>Ehlib 过滤功能实现示例代码下载：<a href=http://www.2ccc.com/>Delphi 盒子</a></p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Delphier</span></p><p class=copyright-item><span>Words:</span>
<span>1667</span></p><p class=copyright-item></p></div><div class=post-tags><section><i class="iconfont icon-icon-tag"></i>Tag:
<span class=tag><a href=https://www.delphier.com/tags/delphi/>#Delphi</a></span>
<span class=tag><a href=https://www.delphier.com/tags/ehlib/>#EhLib</a></span></section><section><a href=javascript:window.history.back();>Back</a></span> ·
<span><a href=https://www.delphier.com/>Home</a></span></section></div><div class=post-nav><a href=https://www.delphier.com/posts/2008/newyear2008/ class=prev rel=prev title=2008，新的一年！><i class="iconfont icon-dajiantou"></i>&nbsp;2008，新的一年！</a>
<a href=https://www.delphier.com/posts/2008/prisonbreak-lost-return/ class=next rel=next title=《越狱》《迷失》快回来了！>《越狱》《迷失》快回来了！&nbsp;<i class="iconfont icon-xiaojiantou"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2019</span>
<span class=author itemprop=copyrightHolder><a href=https://www.delphier.com/>Delphier</a> |</span>
<span>Crafted with ❤️ by <a href=https://github.com/Fastbyte01/KeepIt target=_blank rel="external nofollow noopener noreffer">KeepIt</a> & <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.12/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script></div></body></html>